/**
 * yii2-dynamic-form
 *
 * A jQuery plugin to clone form elements in a nested manner, maintaining accessibility.
 *
 * @author Wanderson Bragan√ßa <wanderson.wbc@gmail.com>
 */
!function($){var pluginName="yiiDynamicForm",regexID=/^(.+?)([-\d-]{1,})(.+)$/i,regexName=/(^.+?)([\[\d{1,}\]]{1,})(\[.+\]$)/i;$.fn.yiiDynamicForm=function(a){return methods[a]?methods[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?($.error("Method "+a+" does not exist on jQuery.yiiDynamicForm"),!1):methods.init.apply(this,arguments)};var events={beforeInsert:"beforeInsert",afterInsert:"afterInsert",beforeDelete:"beforeDelete",afterDelete:"afterDelete",limitReached:"limitReached"},methods={init:function(a){return this.each(function(){a.template=_parseTemplate(a)})},addItem:function(a,b,c){_addItem(a,b,c)},deleteItem:function(a,b,c){_deleteItem(a,b,c)},updateContainer:function(){var widgetOptions=eval($(this).attr("data-dynamicform"));_updateAttributes(widgetOptions),_restoreSpecialJs(widgetOptions),_fixFormValidaton(widgetOptions)}},_parseTemplate=function(widgetOptions){var $template=$(widgetOptions.template);$template.find("div[data-dynamicform]").each(function(){var widgetOptions=eval($(this).attr("data-dynamicform"));if($(widgetOptions.widgetItem).length>1&&$(this).find(widgetOptions.widgetItem).first().length>0){var item=$(this).find(widgetOptions.widgetItem).first()[0].outerHTML;$(this).find(widgetOptions.widgetBody).html(item)}}),$template.find("input, textarea, select").each(function(){if($(this).is(":checkbox")||$(this).is(":radio")){var c=$(this).is(":checkbox")?"checkbox":"radio",a=$(this).attr("name"),b=$template.find('input[type="hidden"][name="'+a+'"]').first(),d=$template.find('input[type="'+c+'"][name="'+a+'"]').length;b&&1===d&&($(this).val(1),b.val(0)),$(this).prop("checked",!1)}else $(this).is("select")?$(this).find("option:selected").removeAttr("selected"):$(this).val("")});var yiiActiveFormData=$("#"+widgetOptions.formId).yiiActiveForm("data");return yiiActiveFormData&&yiiActiveFormData.settings&&($template.find("."+yiiActiveFormData.settings.errorCssClass).removeClass(yiiActiveFormData.settings.errorCssClass),$template.find("."+yiiActiveFormData.settings.successCssClass).removeClass(yiiActiveFormData.settings.successCssClass)),$template},_getWidgetOptionsRoot=function(widgetOptions){return eval($(widgetOptions.widgetBody).parents("div[data-dynamicform]").last().attr("data-dynamicform"))},_getLevel=function(b){var a=b.parents("div[data-dynamicform]").length;return a<0?0:a},_count=function(b,a){return b.closest("."+a.widgetContainer).find(a.widgetItem).length},_createIdentifiers=function(a){return new Array(a+2).join("0").split("")},_addItem=function(a,c,b){_count(b,a)<a.limit?(__distinctRecursive("[data-dynamicform^=dynamicform]",$newclone=($toclone=a.template).clone(!1,!1)),"top"===a.insertPosition?b.closest("."+a.widgetContainer).find(a.widgetBody).prepend($newclone):b.closest("."+a.widgetContainer).find(a.widgetBody).append($newclone),_updateAttributes(a),_restoreSpecialJs(a),_fixFormValidaton(a),b.closest("."+a.widgetContainer).triggerHandler(events.afterInsert,$newclone)):b.closest("."+a.widgetContainer).triggerHandler(events.limitReached,a.limit)},__distinctRecursive=function(regex,$item){var $items=$item.find(regex);$.each($items,function(i,item){var formObject,widgetItem=eval($(item).data("dynamicform")).widgetItem;$(item).find(widgetItem+":not(:nth-child(1))").remove(),__distinctRecursive(regex,$(item))})},_removeValidations=function($elem,widgetOptions,count){if(count>1){$elem.find("div[data-dynamicform]").each(function(){for(var currentWidgetOptions=eval($(this).attr("data-dynamicform")),level=_getLevel($(this)),identifiers=_createIdentifiers(level),numItems=$(this).find(currentWidgetOptions.widgetItem).length,i=1;i<=numItems-1;i++){var aux=identifiers;aux[level]=i,currentWidgetOptions.fields.forEach(function(b){var a=b.id.replace("{}",aux.join("-"));"undefined"!==$("#"+currentWidgetOptions.formId).yiiActiveForm("find",a)&&$("#"+currentWidgetOptions.formId).yiiActiveForm("remove",a)})}});var level=_getLevel($elem.closest("."+widgetOptions.widgetContainer)),widgetOptionsRoot=_getWidgetOptionsRoot(widgetOptions),identifiers=_createIdentifiers(level);identifiers[0]=$(widgetOptionsRoot.widgetItem).length-1,identifiers[level]=count-1,widgetOptions.fields.forEach(function(b){var a=b.id.replace("{}",identifiers.join("-"));"undefined"!==$("#"+widgetOptions.formId).yiiActiveForm("find",a)&&$("#"+widgetOptions.formId).yiiActiveForm("remove",a)})}},_deleteItem=function(a,e,b){var c=_count(b,a);if(c>a.min){$todelete=b.closest(a.widgetItem);var d=$("."+a.widgetContainer).triggerHandler(events.beforeDelete,$todelete);!1!==d&&(_removeValidations($todelete,a,c),$todelete.remove(),_updateAttributes(a),_restoreSpecialJs(a),_fixFormValidaton(a),$("."+a.widgetContainer).triggerHandler(events.afterDelete))}},_updateAttrID=function($elem,index){var widgetOptions=eval($elem.closest("div[data-dynamicform]").attr("data-dynamicform")),id=$elem.attr("id"),newID=id;if(void 0!==id){var matches=id.match(regexID);if(matches&&4===matches.length){matches[2]=matches[2].substring(1,matches[2].length-1);var identifiers=matches[2].split("-");if(identifiers[0]=index,identifiers.length>1){var widgetsOptions=[];$elem.parents("div[data-dynamicform]").each(function(i){widgetsOptions[i]=eval($(this).attr("data-dynamicform"))}),widgetsOptions=widgetsOptions.reverse();for(var i=identifiers.length-1;i>=1;i--)void 0!==widgetsOptions[i]&&(identifiers[i]=$elem.closest(widgetsOptions[i].widgetItem).index())}newID=matches[1]+"-"+identifiers.join("-")+"-"+matches[3],$elem.attr("id",newID)}else newID=id+index,$elem.attr("id",newID)}return id!==newID&&($elem.closest(widgetOptions.widgetItem).find(".field-"+id).each(function(){$(this).removeClass("field-"+id).addClass("field-"+newID)}),$elem.closest(widgetOptions.widgetItem).find("label[for='"+id+"']").attr("for",newID)),newID},_updateAttrName=function($elem,index){var name=$elem.attr("name");if(void 0!==name){var matches=name.match(regexName);if(matches&&4===matches.length){matches[2]=matches[2].replace(/\]\[/g,"-").replace(/\]|\[/g,"");var identifiers=matches[2].split("-");if(identifiers[0]=index,identifiers.length>1){var widgetsOptions=[];$elem.parents("div[data-dynamicform]").each(function(i){widgetsOptions[i]=eval($(this).attr("data-dynamicform"))}),widgetsOptions=widgetsOptions.reverse();for(var i=identifiers.length-1;i>=1;i--)identifiers[i]=$elem.closest(widgetsOptions[i].widgetItem).index()}name=matches[1]+"["+identifiers.join("][")+"]"+matches[3],$elem.attr("name",name)}}return name},_updateAttributes=function(a){var b=_getWidgetOptionsRoot(a);$(b.widgetItem).each(function(a){$(this),$(this).find("*").each(function(){_updateAttrID($(this),a),_updateAttrName($(this),a)})})},_fixFormValidatonInput=function(c,a,b,d){void 0!==a&&((a=$.extend(!0,{},a)).id=b,a.container=".field-"+b,a.input="#"+b,a.name=d,a.value=$("#"+b).val(),a.status=0,"undefined"!==$("#"+c.formId).yiiActiveForm("find",b)&&$("#"+c.formId).yiiActiveForm("remove",b),$("#"+c.formId).yiiActiveForm("add",a))},_fixFormValidaton=function(widgetOptions){var widgetOptionsRoot=_getWidgetOptionsRoot(widgetOptions);$(widgetOptionsRoot.widgetBody).find("input, textarea, select").each(function(){var id=$(this).attr("id"),name=$(this).attr("name");if(void 0!==id&& void 0!==name){currentWidgetOptions=eval($(this).closest("div[data-dynamicform]").attr("data-dynamicform"));var matches=id.match(regexID);if(matches&&4===matches.length){matches[2]=matches[2].substring(1,matches[2].length-1);var level=_getLevel($(this)),identifiers=_createIdentifiers(level-1),baseID=matches[1]+"-"+identifiers.join("-")+"-"+matches[3],attribute=$("#"+currentWidgetOptions.formId).yiiActiveForm("find",baseID);_fixFormValidatonInput(currentWidgetOptions,attribute,id,name)}}})},_restoreKrajeeDepdrop=function($elem){var inputID,configDepdrop=$.extend(!0,{},eval($elem.attr("data-krajee-depdrop"))),matchID=$elem.attr("id").match(regexID);if(matchID&&4===matchID.length)for(index=0;index<configDepdrop.depends.length;++index){var match=configDepdrop.depends[index].match(regexID);match&&4===match.length&&(configDepdrop.depends[index]=match[1]+matchID[2]+match[3])}$elem.depdrop(configDepdrop)},_restoreSpecialJs=function(widgetOptions){var widgetOptionsRoot=_getWidgetOptionsRoot(widgetOptions),$hasInputmask=$(widgetOptionsRoot.widgetItem).find("[data-plugin-inputmask]");$hasInputmask.length>0&&$hasInputmask.each(function(){$(this).inputmask("remove"),$(this).inputmask(eval($(this).attr("data-plugin-inputmask")))});var $hasDatepicker=$(widgetOptionsRoot.widgetItem).find("[data-krajee-kvdatepicker]");$hasDatepicker.length>0&&$hasDatepicker.each(function(){$(this).parent().removeData().kvDatepicker("destroy"),$(this).parent().kvDatepicker(eval($(this).attr("data-krajee-kvdatepicker")))});var $hasTimepicker=$(widgetOptionsRoot.widgetItem).find("[data-krajee-timepicker]");$hasTimepicker.length>0&&$hasTimepicker.each(function(){$(this).removeData().off(),$(this).parent().find(".bootstrap-timepicker-widget").remove(),$(this).unbind(),$(this).timepicker(eval($(this).attr("data-krajee-timepicker")))});var $hasMaskmoney=$(widgetOptionsRoot.widgetItem).find("[data-krajee-maskMoney]");$hasMaskmoney.length>0&&$hasMaskmoney.each(function(){$(this).parent().find("input").removeData().off();var id="#"+$(this).attr("id"),displayID=id+"-disp";$(displayID).maskMoney("destroy"),$(displayID).maskMoney(eval($(this).attr("data-krajee-maskMoney"))),$(displayID).maskMoney("mask",parseFloat($(id).val())),$(displayID).on("change",function(){var a=$(displayID).maskMoney("unmasked")[0];$(id).val(a),$(id).trigger("change")})});var $hasFileinput=$(widgetOptionsRoot.widgetItem).find("[data-krajee-fileinput]");$hasFileinput.length>0&&$hasFileinput.each(function(){$(this).fileinput(eval($(this).attr("data-krajee-fileinput")))});var $hasTouchSpin=$(widgetOptionsRoot.widgetItem).find("[data-krajee-TouchSpin]");$hasTouchSpin.length>0&&$hasTouchSpin.each(function(){$(this).TouchSpin("destroy"),$(this).TouchSpin(eval($(this).attr("data-krajee-TouchSpin")))});var $hasTypehead=$(widgetOptionsRoot.widgetItem).find("[data-krajee-typeahead]");$hasTypehead.length>0&&$hasTypehead.each(function(){$(this).typeahead("destroy");var a=$(this).attr("data-template"),c=$(this).attr("data-empty"),b=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace($(this).attr("data-display")),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:$(this).attr("data-url"),wildcard:"%QUERY"}});void 0!==a?$(this).typeahead(null,{name:$(this).attr("id"),display:$(this).attr("data-display"),source:b,templates:{empty:[c],suggestion:Handlebars.compile(a)}}):$(this).typeahead(null,{name:$(this).attr("id"),display:$(this).attr("data-display"),source:b})});var $hasSpectrum=$(widgetOptionsRoot.widgetItem).find(".spectrum-source");$hasSpectrum.length>0&&$hasSpectrum.each(function(){var b={showInput:!0,showInitial:!0,showPalette:!0,showSelectionPalette:!0,showAlpha:!0,allowEmpty:!0,preferredFormat:"hex",theme:"sp-krajee",cancelText:"cancel",chooseText:"choose",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",togglePaletteMoreText:"more",togglePaletteLessText:"less",palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]},a="#"+$(this).attr("id"),c=a.match(regexID);jQuery(c[1]+c[2]+"color").on("change",function(){jQuery(a).val(this.value)}),jQuery(a).on("input change",function(a){jQuery(c[1]+c[2]+"color").val(this.value),"change"==a.type&&jQuery(c[1]+c[2]+"color").trigger("change")}),jQuery.when(jQuery(a).spectrum(b)).done(function(){jQuery(a).spectrum("set",jQuery(c[1]+c[2]+"color").val()),jQuery(c[1]+c[2]+"color-cont").removeClass("kv-center-loading")}),jQuery(a).spectrum(b)});var $hasDepdrop=$(widgetOptionsRoot.widgetItem).find("[data-krajee-depdrop]");$hasDepdrop.length>0&&$hasDepdrop.each(function(){void 0===$(this).data("select2")&&($(this).removeData().off(),$(this).unbind(),_restoreKrajeeDepdrop($(this)))});var $hasSelect2=$(widgetOptionsRoot.widgetItem).find("[data-krajee-select2]");$hasSelect2.length>0&&$hasSelect2.each(function(){var loadingText,id=$(this).attr("id"),$id=$("#"+id),configSelect2=eval($(this).attr("data-krajee-select2"));$(this).data("select2")&&$(this).select2("destroy");var configDepdrop=$(this).data("depdrop");configDepdrop&&(configDepdrop=$.extend(!0,{},configDepdrop),$(this).removeData().off(),$(this).unbind(),_restoreKrajeeDepdrop($(this)));var s2LoadingFunc="undefined"!=typeof initSelect2Loading?initSelect2Loading:initS2Loading,s2OpenFunc="undefined"!=typeof initSelect2DropStyle?initSelect2Loading:initS2Loading;$.when($id.select2(configSelect2)).done(s2LoadingFunc(id,".select2-container--krajee"));var kvClose="kv_close_"+id.replace(/\-/g,"_");$id.on("select2:opening",function(a){s2OpenFunc(id,kvClose,a)}),$id.on("select2:unselect",function(){window[kvClose]=!0}),configDepdrop&&initDepdropS2(id,configDepdrop.loadingText?configDepdrop.loadingText:"Loading ...")})}}(window.jQuery)
